<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "https://www.simplemachines.org/xml/modification">
<modification xmlns="https://www.simplemachines.org/xml/modification" xmlns:smf="https://www.simplemachines.org/">
	<id>spuds:member_awards</id>
	<version>3.1</version>

<file name="$themedir/Display.template.php">
	<!-- These are the edits to the default display template.  If you are using a CUSTOM THEME they might not work at all! -->
	<!-- If that happens, find something closely resembling it the items in the search operation, and do the necessary -->
	<!-- edits yourself.  Again these are the CURVE edits -->
	<operation error="ignore">
		<search position="before"><![CDATA[	// Show the member's primary group (like 'Administrator') if they have one.
	if (!empty($message['member']['group']))
		echo '
								<li class="membergroup">', $message['member']['group'], '</li>';]]></search>
		<add><![CDATA[

	// Show their above profile awards, like badges and stuff
	if (!empty($message['member']['awards']) && (int) $modSettings['awards_in_post'] > 0 && !empty($modSettings['awards_enabled']))
	{
		$awards = 0;
		$award_output = '';

		foreach ($message['member']['awards'] as $award)
		{
			if (((int) $award['location'] === 2) && ($awards < $modSettings['awards_in_post']))
			{
				$award_output .= '
						<a href="' . $scripturl . $award['more'] . '">
							<img src="' . dirname($scripturl) . $award['img'] . '" alt="' . $award['description'] . '" title="' . $award['description'] . '" />
						</a> ';
				$awards++;
			}
		}

		// If we found awards to output in this location ...
		if (!empty($awards))
		{
			$style = (empty($modSettings['awards_aboveavatar_format']) || $modSettings['awards_aboveavatar_format'] == 1)
				? 'award_top award_poster_1'
				: ((int) $modSettings['awards_aboveavatar_format'] === 2
					? 'award_top award_poster_2"' : 'award_top award_poster_3');

			echo '
				<li>
					<fieldset class="', $style , '">';

			if (isset($modSettings['awards_aboveavatar_title']))
				echo '
						<legend><a href="' . $scripturl . '?action=profile;area=showAwards;u=' . $message['member']['id'] . '" title="' . $txt['awards'] . '">' . $modSettings['awards_aboveavatar_title'] . '</a></legend>';

			echo $award_output;

			echo '
					</fieldset>
				</li>';
		}
	}]]></add>
	</operation>

	<operation error="ignore">
		<search position="after"><![CDATA[		// Any custom fields for standard placement?
		if (!empty($message['custom_fields']['standard']))
			foreach ($message['custom_fields']['standard'] as $custom)]]></search>
		<add><![CDATA[
		// Show their below profile awards?
		if (!empty($message['member']['awards']) && $modSettings['awards_in_post'] > 0 && !empty($modSettings['awards_enabled']))
		{
			$awards = 0;
			$award_output = '';

			foreach ($message['member']['awards'] as $award)
			{
				if (((int) $award['location'] === 1) && ($awards < $modSettings['awards_in_post']))
				{
					$award_output .= '
							<a href="' . $scripturl . $award['more'] . '">
								<img src="' . dirname($scripturl) . $award['img'] . '" alt="' . $award['description'] . '" title="' . $award['description'] . '" />
							</a> ';
					$awards++;
				}
			}

			// If we found some to output here, then show them
			if (!empty($awards))
			{
				$style = (empty($modSettings['awards_belowavatar_format']) || $modSettings['awards_belowavatar_format'] == 1)
					? 'award_bottom award_poster_1'
					: ($modSettings['awards_belowavatar_format'] == 2
						? 'award_bottom award_poster_2"' : 'award_bottom award_poster_3');

				echo '
					<li>
						<fieldset class="', $style, '">';

				if (isset($modSettings['awards_belowavatar_title']))
					echo '
							<legend><a href="' . $scripturl . '?action=profile;area=showAwards;u=' . $message['member']['id'] . '" title="' . $txt['awards'] . '">' . $modSettings['awards_belowavatar_title'] . '</a></legend>';

				echo $award_output;

				echo '
						</fieldset>
					</li>';
			}
		}

]]></add>
	</operation>

	<operation error="ignore">
			<search position="before"><![CDATA[	// Show the member's signature?
	if (!empty($message['member']['signature']) && empty($options['show_no_signatures']) && $context['signature_enabled'])
		echo '
							<div class="signature" id="msg_', $message['id'], '_signature"', $ignoring ? ' style="display:none;"' : '', '>
								', $message['member']['signature'], '
							</div>';]]></search>
			<add><![CDATA[

	// Show their signature awards?
	if (!empty($message['member']['awards']) && (int) $modSettings['awards_in_post'] > 0 && !empty($modSettings['awards_enabled']))
	{
		$awards = 0;
		$award_output = '';

		foreach ($message['member']['awards'] as $award)
		{
			if (((int) $award['location'] === 3) && ($awards < $modSettings['awards_in_post']))
			{
				$award_output .= '
								<a href="' . $scripturl . $award['more'] . '">
									<img src="' . dirname($scripturl) . $award['img'] . '" alt="' . $award['description'] . '" title="' . $award['description'] . '" />
								</a> ';
				$awards++;
			}
		}

		// If we found some to output here, then show them
		if (!empty($awards))
		{
			$style = (empty($modSettings['awards_signature_format']) || (int) $modSettings['awards_signature_format'] === 1)
				? 'award_signature_1'
				: ((int) $modSettings['awards_signature_format'] === 2
					? 'award_signature_2"' : 'award_signature_3');

			echo '
						<div class="signature">
							<fieldset class="', $style, '">';

			if (isset($modSettings['awards_signature_title']))
				echo '
								<legend><a href="' . $scripturl . '?action=profile;area=showAwards;u=' . $message['member']['id'] . '" title="' . $txt['awards'] . '">' . $modSettings['awards_signature_title'] . '</a></legend>';

			echo $award_output;

			echo '
							</fieldset>
						</div>';
		}
	}]]></add>
	</operation>

	<operation error="ignore">
		<search position="after"><![CDATA[			// Since we know this person isn't a guest, you *can* message them.
			if ($context['can_send_pm'])
				echo '
										<li><a href="', $scripturl, '?action=pm;sa=send;u=', $message['member']['id'], '" title="', $message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline'], '">', $settings['use_image_buttons'] ? '<span class="main_icons im_' . ($message['member']['online']['is_online'] ? 'on' : 'off') . ' centericon" title="' . ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']) . '"></span> ' : ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']), '</a></li>';]]></search>
		<add><![CDATA[
			// Awards!
			if (!empty($modSettings['awards_enabled']))
				echo '
										<li><a href="', $scripturl, '?action=profile;area=showAwards;u=', $message['member']['id'], '" title="', $txt['awards'], '">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/award.gif" alt="' . $txt['awards'] . '" title="' . $txt['awards'] . '" border="0" />' : $txt['awards']), '</a></li>';]]></add>
	</operation>
</file>

</modification>